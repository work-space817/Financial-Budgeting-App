{"version":3,"sources":["components/containers/CropperComponent/CropperComponent.tsx","components/containers/CropperComponent/CropperComponent.module.css","components/Categories/EditCategoryPage/validation.ts","components/Categories/EditCategoryPage/EditCategoryPage.tsx"],"names":["CropperComponent","onChange","field","error","touched","value","aspectRatio","useState","img","setImg","cropperObj","setCropperObj","imgRef","useRef","prevRef","base64","setBase64","showModal","setShowModal","handleImageChange","e","file","target","files","url","URL","createObjectURL","replace","useEffect","current","cropper","Cropper","viewMode","preview","className","classes","formGroup","htmlFor","style","height","width","classNames","labelInput","bgImg","src","alt","id","type","onClose","modalBody","image","ref","border","overflow","onClick","rotate","icon","faSync","size","base","getCroppedCanvas","toDataURL","faCheckCircle","faTimesCircle","module","exports","EditCategorySchema","yup","required","title","urlSlug","nullable","priority","EditCategoryPage","useTypedSelector","store","categoryCrud","categoryData","loading","useActions","updateCategory","getCategoryById","useParams","_id","Number","navigator","useNavigate","initValues","onHandleSubmit","values","serverErrors","console","log","formik","useFormik","initialValues","validationSchema","onSubmit","enableReinitialize","errors","handleChange","handleSubmit","setFieldValue","Helmet","uuid","InputGroup","label","disabled"],"mappings":"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","file":"static/js/16.c5be9441.chunk.js","sourcesContent":["import Cropper from \"cropperjs\";\r\nimport { LegacyRef, useEffect, useRef, useState } from \"react\";\r\nimport Modal from \"../Modal/Modal\";\r\nimport classes from \"./CropperComponent.module.css\";\r\n\r\nimport \"cropperjs/dist/cropper.css\";\r\nimport classNames from \"classnames\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport {\r\n  faSync,\r\n  faCheckCircle,\r\n  faTimesCircle,\r\n} from \"@fortawesome/free-solid-svg-icons\";\r\n\r\nexport interface IGetCropperProps {\r\n  onChange: (field: string, value: string) => void;\r\n  field: string;\r\n  value?: string;\r\n  error?: string;\r\n  touched?: boolean;\r\n  aspectRatio?: number;\r\n}\r\n\r\nconst CropperComponent: React.FC<IGetCropperProps> = ({\r\n  onChange,\r\n  field,\r\n  error,\r\n  touched,\r\n  value,\r\n  aspectRatio = 16 / 9,\r\n}) => {\r\n  const [img, setImg] = useState<string>(value as string);\r\n  const [cropperObj, setCropperObj] = useState<Cropper>();\r\n  const imgRef = useRef<HTMLImageElement>(null);\r\n  const prevRef = useRef<HTMLDivElement>();\r\n  const [base64, setBase64] = useState<any>();\r\n  const [showModal, setShowModal] = useState(false);\r\n\r\n  const handleImageChange = async (e: any) => {\r\n    const file = (e.target.files as FileList)[0];\r\n    if (file) {\r\n      const url = URL.createObjectURL(file);\r\n      await setImg(url);\r\n      cropperObj?.replace(url);\r\n      setShowModal(true);\r\n    }\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (imgRef.current) {\r\n      const cropper = new Cropper(imgRef.current as HTMLImageElement, {\r\n        aspectRatio: aspectRatio,\r\n        viewMode: 1,\r\n        preview: prevRef.current,\r\n      });\r\n      cropper.replace(img);\r\n      setCropperObj(cropper);\r\n    }\r\n  }, [showModal, img, aspectRatio]);\r\n\r\n  const rotateImg = () => {\r\n    if (imgRef.current) {\r\n      cropperObj?.rotate(90);\r\n    }\r\n  };\r\n\r\n  const getBase64 = () => {\r\n    const base = cropperObj?.getCroppedCanvas().toDataURL() as string;\r\n    setBase64(base);\r\n    setShowModal(false);\r\n    onChange(field as string, base);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <form className={classes.formGroup}>\r\n        <label htmlFor={field} style={{ height: \"100%\", width: \"100%\" }}>\r\n          <div\r\n            className={classNames(\r\n              classes.labelInput,\r\n              { \"text-danger border border-danger rounded\": touched && error },\r\n              { \"is-valid border border-success rounded\": touched && !error }\r\n            )}\r\n          >\r\n            {base64 && (\r\n              <img className={classes.bgImg} src={base64} alt=\"asdas\" />\r\n            )}\r\n            {!base64 && (\r\n              <>\r\n                {value && (\r\n                  <img style={{ width: \"100%\" }} src={value} alt=\"asdasda\" />\r\n                )}\r\n                {!value && (\r\n                  <>\r\n                    <i className=\"fa fa-image fa-5x\"></i>\r\n                    <span className=\"d-block\">Для вибору фото натисніть</span>\r\n                  </>\r\n                )}\r\n              </>\r\n            )}\r\n            {error && <div>{error}</div>}\r\n          </div>\r\n        </label>\r\n\r\n        <input\r\n          id={field}\r\n          className=\"d-none\"\r\n          type=\"file\"\r\n          onChange={handleImageChange}\r\n        />\r\n      </form>\r\n\r\n      {showModal && (\r\n        <Modal\r\n          onClose={() => {\r\n            setShowModal(false);\r\n          }}\r\n        >\r\n          <div className={classes.modalBody}>\r\n            <div className={classes.image}>\r\n              {\r\n                <img\r\n                  ref={imgRef as LegacyRef<HTMLImageElement>}\r\n                  src={value}\r\n                  alt=\"asdds\"\r\n                />\r\n              }\r\n            </div>\r\n            <div\r\n              ref={prevRef as LegacyRef<HTMLDivElement>}\r\n              style={{\r\n                height: \"150px\",\r\n                width: \"150px\",\r\n                border: \"1px solid silver\",\r\n                overflow: \"hidden\",\r\n              }}\r\n            ></div>\r\n            <div className=\"d-flex justify-content-around mt-2\">\r\n              <button\r\n                onClick={rotateImg}\r\n                type=\"button\"\r\n                className=\"btn btn-outline-secondary\"\r\n              >\r\n                <FontAwesomeIcon icon={faSync} size={\"2x\"} />\r\n              </button>\r\n              <div\r\n                className=\"d-flex justify-content-between\"\r\n                style={{ width: \"150px\" }}\r\n              >\r\n                <button\r\n                  onClick={getBase64}\r\n                  type=\"button\"\r\n                  className=\"btn btn-outline-success\"\r\n                >\r\n                  <FontAwesomeIcon icon={faCheckCircle} size={\"2x\"} />\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    setShowModal(false);\r\n                  }}\r\n                  type=\"button\"\r\n                  className=\"btn btn-outline-danger\"\r\n                >\r\n                  <FontAwesomeIcon icon={faTimesCircle} size={\"2x\"} />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Modal>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CropperComponent;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"modalBody\":\"CropperComponent_modalBody__2D_CS\",\"image\":\"CropperComponent_image__2KbH0\",\"formGroup\":\"CropperComponent_formGroup__31n-Q\",\"labelInput\":\"CropperComponent_labelInput__3e2Hl\",\"bgImg\":\"CropperComponent_bgImg__7A-8d\"};","import * as yup from \"yup\";\r\n\r\nexport const EditCategorySchema = yup.object({\r\n  id: yup.number().required(),\r\n  title: yup.string().required(\"Поле не повинне бути пустим\"),\r\n  urlSlug: yup.string().required(\"Поле не повинне бути пустим\"),\r\n  image: yup.array().nullable(),\r\n  priority: yup\r\n    .string().required(\"Поле не повинне бути пустим\")\r\n});\r\n","import { Form, FormikProvider, useFormik } from 'formik';\r\nimport { useEffect } from 'react';\r\nimport { useNavigate, useParams } from 'react-router';\r\nimport { useActions } from '../../../hooks/useActions';\r\nimport { useTypedSelector } from '../../../hooks/useTypedSelector';\r\nimport EclipseWidget from '../../common/eclipse';\r\nimport InputGroup from '../../common/InputGroup';\r\nimport { CategoryInfo } from '../types';\r\nimport { EditCategorySchema } from './validation';\r\nimport { UpdateErrors } from '../types/UpdateCategory';\r\nimport { Helmet } from 'react-helmet';\r\nimport { Card } from 'primereact/card';\r\nimport CropperComponent from '../../containers/CropperComponent/CropperComponent';\r\nimport { Button } from 'primereact/button';\r\nimport { v4 as uuid } from 'uuid';\r\n\r\nconst EditCategoryPage = () => {\r\n  const { categoryData, loading } = useTypedSelector((store) => store.categoryCrud);\r\n  const { updateCategory, getCategoryById } = useActions();\r\n    const { id } = useParams();\r\n    const _id = Number(id);\r\n  useEffect(() => {\r\n    getCategoryById(_id);\r\n  }, [getCategoryById, _id]);\r\n\r\n  const navigator = useNavigate();\r\n\r\n  \r\n  let initValues: CategoryInfo = {\r\n    id: _id,\r\n    title: categoryData.title,\r\n    urlSlug: categoryData.urlSlug,\r\n    priority: categoryData.priority,\r\n    image: categoryData.image,\r\n  };\r\n\r\n  const onHandleSubmit = async (values: CategoryInfo) => {\r\n    try {\r\n      await updateCategory(values);\r\n      navigator('/adminPanel/categories');\r\n    } catch (error) {\r\n      const serverErrors = error as UpdateErrors;\r\n\r\n      console.log(serverErrors);\r\n    }\r\n  };\r\n\r\n  const formik = useFormik({\r\n    initialValues: initValues,\r\n    validationSchema: EditCategorySchema,\r\n    onSubmit: onHandleSubmit,\r\n    enableReinitialize: true\r\n  });\r\n\r\n  const { errors, touched, handleChange, handleSubmit, setFieldValue, values } = formik;\r\nconsole.log(values);\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>Редагувати категорію</title>\r\n      </Helmet>\r\n      {loading && <EclipseWidget />}\r\n      {!loading && (\r\n        <Card title=\"Редагувати категорію\">\r\n          <FormikProvider value={formik}>\r\n            <Form onSubmit={handleSubmit}>\r\n              <div className=\"row d-flex justify-content-around border border-secondary border-3 rounded-4 p-4 m-5\">\r\n                <div className=\"col-6\">\r\n                  <CropperComponent\r\n                    field=\"image\"\r\n                    onChange={setFieldValue}\r\n                    error={errors.image}\r\n                    touched={touched.image}\r\n                    value={`https://vovalohika.tk/images/300_${values.image}?t=${uuid()}`}\r\n                  />\r\n                </div>\r\n                <div className=\"col-6\">\r\n                  <InputGroup\r\n                    field=\"title\"\r\n                    label=\"Назва категорії\"\r\n                    error={errors.title}\r\n                    touched={touched.title}\r\n                    value={values.title}\r\n                    onChange={handleChange}\r\n                  />\r\n\r\n                  <InputGroup\r\n                    field=\"priority\"\r\n                    label=\"Пріорітет\"\r\n                    error={errors.priority}\r\n                    touched={touched.priority}\r\n                    value={values.priority}\r\n                    onChange={handleChange}\r\n                  />\r\n\r\n                  <InputGroup\r\n                    field=\"urlSlug\"\r\n                    label=\"urlSlug\"\r\n                    error={errors.urlSlug}\r\n                    onChange={handleChange}\r\n                    touched={touched.urlSlug}\r\n                    value={values.urlSlug}\r\n                  />\r\n\r\n                  {/* <InputGroup\r\n                    field=\"image\"\r\n                    label=\"Аватар\"\r\n                    type=\"file\"\r\n                    error={errors.image}\r\n                    onChange={handleFileChange}\r\n                    touched={touched.image}\r\n                  /> */}\r\n                </div>\r\n\r\n                <div className=\"p-d-flex p-jc-center\">\r\n                  <Button\r\n                    type=\"submit\"\r\n                    label=\"Редагувати категорію\"\r\n                    icon=\"pi pi-plus\"\r\n                    disabled={loading}></Button>\r\n                </div>\r\n              </div>\r\n            </Form>\r\n        <div className=\"col-4\"></div>\r\n\r\n          </FormikProvider>\r\n        </Card>\r\n      )}\r\n    </>\r\n  );\r\n};\r\nexport default EditCategoryPage;\r\n"],"sourceRoot":""}